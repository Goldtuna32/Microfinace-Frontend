<!-- Enhanced HTML Structure -->
<div class="cif-create-container">
    <div class="cif-card">
      <!-- Card Header -->
      <div class="card-header">
        <h4 class="card-title">
          <i class="bi bi-person-badge"></i>
          Create Customer Information File (CIF)
        </h4>
      </div>
  
      <!-- Card Body -->
      <div class="card-body">
        <form [formGroup]="cifForm" (ngSubmit)="onSubmit()">
          <!-- Personal Information Section -->
          <div class="form-section">
            <h5 class="section-title">
              <i class="bi bi-person-lines-fill"></i>
              Personal Information
            </h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-person"></i> Full Name <span class="required-star">*</span>
                </label>
                <input type="text" class="form-control" formControlName="name" placeholder="Enter full name">
                <div *ngIf="cifForm.get('name')?.touched && cifForm.get('name')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('name')?.errors?.['required']">Full Name is required</span>
                  <span *ngIf="cifForm.get('name')?.errors?.['duplicate']">This name is already registered</span>
                </div>
              </div>
              
              <div class="col-md-3">
                <label class="form-label">
                  <i class="bi bi-card-heading"></i> NRC Prefix <span class="required-star">*</span>
                </label>
                <select class="form-select" formControlName="nrcPrefix" (change)="onNrcPrefixChange($event)">
                  <option value="" disabled>Select NRC</option>
             <!-- Change the NRC Prefix option value -->
<option *ngFor="let nrc of nrcFormats" 
[value]="nrc.nrc_code + '/' + nrc.code + '(N)'"> <!-- Use code instead of name_en -->
{{ nrc.nrc_code }} / {{ nrc.name_en }} ({{ nrc.code }})
</option>
                </select>
                <div *ngIf="cifForm.get('nrcPrefix')?.touched && cifForm.get('nrcPrefix')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('nrcPrefix')?.errors?.['required']">NRC Prefix is required</span>
                  <span *ngIf="cifForm.get('nrcPrefix')?.errors?.['duplicate']">This NRC is already registered</span>
                </div>
              </div>
              
              <div class="col-md-3">
                <label class="form-label">
                  <i class="bi bi-123"></i> NRC Number <span class="required-star">*</span>
                </label>
                <input type="text" class="form-control" formControlName="nrcNumber" placeholder="6-digit number">
                <div *ngIf="cifForm.get('nrcNumber')?.touched && cifForm.get('nrcNumber')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('nrcNumber')?.errors?.['required']">NRC Number is required</span>
                  <span *ngIf="cifForm.get('nrcNumber')?.errors?.['pattern']">Must be a 6-digit number</span>
                  <span *ngIf="cifForm.get('nrcNumber')?.errors?.['duplicate']">This NRC number is already registered</span>
                </div>
              </div>
            </div>
  
            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-calendar"></i> Date of Birth <span class="required-star">*</span>
                </label>
                <input type="date" class="form-control" formControlName="dob" (change)="checkAge()">
                <div *ngIf="cifForm.get('dob')?.touched && cifForm.get('dob')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('dob')?.errors?.['required']">Date of Birth is required</span>
                  <span *ngIf="cifForm.get('dob')?.errors?.['underage']">Must be at least 18 years old</span>
                </div>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-gender-ambiguous"></i> Gender <span class="required-star">*</span>
                </label>
                <select class="form-select" formControlName="gender">
                  <option value="" disabled selected>Select Gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
                <div *ngIf="cifForm.get('gender')?.touched && cifForm.get('gender')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('gender')?.errors?.['required']">Gender is required</span>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Contact Information Section -->
          <div class="form-section">
            <h5 class="section-title">
              <i class="bi bi-telephone"></i>
              Contact Information
            </h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-phone"></i> Phone Number <span class="required-star">*</span>
                </label>
                <input type="tel" class="form-control" formControlName="phoneNumber" placeholder="Enter phone number">
                <div *ngIf="cifForm.get('phoneNumber')?.touched && cifForm.get('phoneNumber')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('phoneNumber')?.errors?.['required']">Phone Number is required</span>
                  <span *ngIf="cifForm.get('phoneNumber')?.errors?.['pattern']">Must be a 10-12 digit number</span>
                  <span *ngIf="cifForm.get('phoneNumber')?.errors?.['duplicate']">This phone number is already registered</span>
                </div>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-envelope"></i> Email <span class="required-star">*</span>
                </label>
                <input type="email" class="form-control" formControlName="email" placeholder="Enter email address">
                <div *ngIf="cifForm.get('email')?.touched && cifForm.get('email')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('email')?.errors?.['required']">Email is required</span>
                  <span *ngIf="cifForm.get('email')?.errors?.['email']">Invalid email format</span>
                  <span *ngIf="cifForm.get('email')?.errors?.['duplicate']">This email is already registered</span>
                </div>
              </div>
            </div>
  
            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-house-door"></i> Address <span class="required-star">*</span>
                </label>
                <input type="text" class="form-control" formControlName="address" placeholder="Enter full address">
                <div *ngIf="cifForm.get('address')?.touched && cifForm.get('address')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('address')?.errors?.['required']">Address is required</span>
                </div>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-briefcase"></i> Occupation <span class="required-star">*</span>
                </label>
                <input type="text" class="form-control" formControlName="occupation" placeholder="Enter occupation">
                <div *ngIf="cifForm.get('occupation')?.touched && cifForm.get('occupation')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('occupation')?.errors?.['required']">Occupation is required</span>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Additional Information Section -->
          <div class="form-section">
            <h5 class="section-title">
              <i class="bi bi-info-circle"></i>
              Additional Information
            </h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-heart"></i> Marital Status <span class="required-star">*</span>
                </label>
                <select class="form-select" formControlName="maritalStatus">
                  <option value="" disabled selected>Select Marital Status</option>
                  <option value="Single">Single</option>
                  <option value="Married">Married</option>
                </select>
                <div *ngIf="cifForm.get('maritalStatus')?.touched && cifForm.get('maritalStatus')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('maritalStatus')?.errors?.['required']">Marital Status is required</span>
                </div>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">
                  <i class="bi bi-cash-stack"></i> Income Source <span class="required-star">*</span>
                </label>
                <input type="text" class="form-control" formControlName="incomeSource" placeholder="Enter income source">
                <div *ngIf="cifForm.get('incomeSource')?.touched && cifForm.get('incomeSource')?.errors" class="error-message text-danger">
                  <i class="bi bi-exclamation-circle-fill"></i>
                  <span *ngIf="cifForm.get('incomeSource')?.errors?.['required']">Income Source is required</span>
                </div>
              </div>
            </div>
  
            <div class="mt-3">
              <label class="form-label">
                <i class="bi bi-building"></i> Branch <span class="required-star">*</span>
              </label>
              <select class="form-select" formControlName="branchId">
                <option value="" disabled selected>Select Branch</option>
                <option *ngFor="let branch of branches" [value]="branch.id">
                  {{ branch.branchName }}
                </option>
              </select>
              <div *ngIf="cifForm.get('branchId')?.touched && cifForm.get('branchId')?.errors" class="error-message text-danger">
                <i class="bi bi-exclamation-circle-fill"></i>
                <span *ngIf="cifForm.get('branchId')?.errors?.['required']">Branch is required</span>
              </div>
            </div>
          </div>
  
          <!-- NRC Upload Section -->
          <div class="form-section">
            <h5 class="section-title">
              <i class="bi bi-file-image"></i>
              NRC Document Upload
            </h5>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="file-upload" (click)="fileInputFront.click()">
                  <i class="bi bi-file-earmark-arrow-up"></i>
                  <h6 class="mb-1">Front NRC Photo</h6>
                  <p class="text-muted small mb-2">Click to upload or drag and drop</p>
                  <input type="file" #fileInputFront (change)="onFileChange($event, 'front')" accept="image/*" class="d-none">
                </div>
                <div *ngIf="frontNrcPreview" class="image-preview mt-2">
                  <img [src]="frontNrcPreview" class="img-fluid rounded" alt="Front NRC Preview">
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="file-upload" (click)="fileInputBack.click()">
                  <i class="bi bi-file-earmark-arrow-up"></i>
                  <h6 class="mb-1">Back NRC Photo</h6>
                  <p class="text-muted small mb-2">Click to upload or drag and drop</p>
                  <input type="file" #fileInputBack (change)="onFileChange($event, 'back')" accept="image/*" class="d-none">
                </div>
                <div *ngIf="backNrcPreview" class="image-preview mt-2">
                  <img [src]="backNrcPreview" class="img-fluid rounded" alt="Back NRC Preview">
                </div>
              </div>
            </div>
          </div>
  
          <!-- Submit Button -->
          <div class="text-end mt-4">
            <button type="submit" class="btn btn-primary btn-submit" 
                    [disabled]="!isFormValid()" [class.pulse-animation]="isFormValid()">
              <i class="bi bi-save-fill me-2"></i> Create CIF
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>