<div class="container fade-in">
  <div class="card">
    <div class="card-body p-4">
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <div>{{ errorMessage }}</div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="loan-summary-card">
            <h5><i class="bi bi-hourglass-split me-2"></i>Pending Loans</h5>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat">{{ pendingLoansDataSource.data.length }}</div>
                <div class="label">Awaiting Approval</div>
              </div>
              <i class="bi bi-file-earmark-text display-4 opacity-25"></i>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="loan-summary-card" style="background: linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%);">
            <h5><i class="bi bi-check-circle me-2"></i>Approved Loans</h5>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat">{{ approvedLoansDataSource.data.length }}</div>
                <div class="label">Active Loans</div>
              </div>
              <i class="bi bi-file-earmark-check display-4 opacity-25"></i>
            </div>
          </div>
        </div>
      </div>
<!-- 
      Search and Filter
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" class="form-control" placeholder="Search loans..." [(ngModel)]="searchTerm" (input)="applyFilter()">
          </div>
        </div>
        <div class="col-md-6 d-flex justify-content-end">
          <button class="btn btn-primary me-2" (click)="exportToExcel()">
            <i class="bi bi-file-earmark-excel me-1"></i> Export
          </button>
          <button class="btn btn-outline-secondary">
            <i class="bi bi-funnel me-1"></i> Filters
          </button>
        </div>
      </div> -->

      <!-- Tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">
            <i class="bi bi-hourglass-split me-1"></i> Pending Loans
            <span class="status-badge badge-pending ms-2">{{ pendingLoansDataSource.data.length }}</span>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab" aria-controls="approved" aria-selected="false">
            <i class="bi bi-check-circle me-1"></i> Approved Loans
            <span class="status-badge badge-approved ms-2">{{ approvedLoansDataSource.data.length }}</span>
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content pt-3">
        <!-- Pending Loans Tab -->
        <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead>
                <tr>
                  <th scope="col">ID</th>
                  <th scope="col">Loan Amount</th>
                  <th scope="col">Interest Rate</th>
                  <th scope="col">Duration</th>
                  <th scope="col">Account</th>
                  <th scope="col">Fees</th>
                  <th scope="col">Late Fees</th>
                  <th scope="col" class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of pendingLoansDataSource.data | slice: (pendingPageIndex * pendingPageSize) : ((pendingPageIndex + 1) * pendingPageSize)">
                  <td><strong>#{{ loan.id }}</strong></td>
                  <td>{{ loan.loanAmount | currency }}</td>
                  <td>{{ loan.interestRate }}%</td>
                  <td>{{ loan.repaymentDuration }} months</td>
                  <td>{{ loan.currentAccountId }}</td>
                  <td>
                    <span class="badge bg-light text-dark me-1" title="Document Fee">{{ loan.documentFee | currency }}</span>
                    <span class="badge bg-light text-dark" title="Service Charges">{{ loan.serviceCharges | currency }}</span>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark">{{ loan.late_fee_rate }}%</span>
                  </td>
                  <td class="text-end">
                    <div class="action-btn-group">
                      <button class="action-btn btn btn-sm btn-outline-success" (click)="approveLoan(loan)" title="Approve">
                        <i class="bi bi-check-lg"></i>
                      </button>
                      <button class="action-btn btn btn-sm btn-outline-primary" (click)="editLoan(loan)" title="Edit">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="action-btn btn btn-sm btn-outline-danger" (click)="deleteLoan(loan)" title="Delete">
                        <i class="bi bi-trash"></i>
                      </button>
                      <button class="action-btn btn btn-sm btn-outline-secondary" (click)="viewDetails(loan)" title="Details">
                        <i class="bi bi-eye"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="!pendingLoansDataSource.data.length">
                  <td colspan="8" class="text-center py-4 text-muted">
                    <i class="bi bi-file-earmark-text display-4 opacity-25 mb-2 d-block"></i>
                    No pending loans found
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          <nav class="mt-4" *ngIf="pendingLoansDataSource.data.length > pendingPageSize">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.disabled]="pendingPageIndex === 0">
                <button class="page-link" (click)="pendingPageIndex = 0" title="First Page">
                  <i class="bi bi-chevron-double-left"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="pendingPageIndex === 0">
                <button class="page-link" (click)="pendingPageIndex = pendingPageIndex - 1" title="Previous Page">
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>
              <li class="page-item" *ngFor="let page of getPendingPages()" [class.active]="pendingPageIndex === page">
                <button class="page-link" (click)="pendingPageIndex = page">{{ page + 1 }}</button>
              </li>
              <li class="page-item" [class.disabled]="pendingPageIndex === getPendingTotalPages() - 1">
                <button class="page-link" (click)="pendingPageIndex = pendingPageIndex + 1" title="Next Page">
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="pendingPageIndex === getPendingTotalPages() - 1">
                <button class="page-link" (click)="pendingPageIndex = getPendingTotalPages() - 1" title="Last Page">
                  <i class="bi bi-chevron-double-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Approved Loans Tab -->
        <div class="tab-pane fade" id="approved" role="tabpanel" aria-labelledby="approved-tab">
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead>
                <tr>
                  <th scope="col">ID</th>
                  <th scope="col">Loan Amount</th>
                  <th scope="col">Interest Rate</th>
                  <th scope="col">Duration</th>
                  <th scope="col">Account</th>
                  <th scope="col">Fees</th>
                  <th scope="col">Late Fees</th>
                  <th scope="col" class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of approvedLoansDataSource.data | slice: (approvedPageIndex * approvedPageSize) : ((approvedPageIndex + 1) * approvedPageSize)">
                  <td><strong>#{{ loan.id }}</strong></td>
                  <td>{{ loan.loanAmount | currency }}</td>
                  <td>{{ loan.interestRate }}%</td>
                  <td>{{ loan.repaymentDuration }} months</td>
                  <td>{{ loan.currentAccountId  }}</td>
                  <td>
                    <span class="badge bg-light text-dark me-1" title="Document Fee">{{ loan.documentFee | currency }}</span>
                    <span class="badge bg-light text-dark" title="Service Charges">{{ loan.serviceCharges | currency }}</span>
                  </td>
                  <td>
                    <span class="badge bg-light text-dark">{{ loan.late_fee_rate }}%</span>
                  </td>
                  <td class="text-end">
                    <div class="action-btn-group">
                      <button class="action-btn btn btn-sm btn-outline-primary" (click)="viewDetails(loan)" title="Details">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="action-btn btn btn-sm btn-outline-info" (click)="showRepaymentSchedule(loan)" title="Schedule">
                        <i class="bi bi-calendar-week"></i>
                      </button>
                      <!-- <button class="action-btn btn btn-sm btn-outline-secondary" (click)="showPaymentHistory(loan)" title="Payments">
                        <i class="bi bi-cash-stack"></i>
                      </button> -->
                    </div>
                  </td>
                </tr>
                <tr *ngIf="!approvedLoansDataSource.data.length">
                  <td colspan="8" class="text-center py-4 text-muted">
                    <i class="bi bi-file-earmark-check display-4 opacity-25 mb-2 d-block"></i>
                    No approved loans found
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          <nav class="mt-4" *ngIf="approvedLoansDataSource.data.length > approvedPageSize">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.disabled]="approvedPageIndex === 0">
                <button class="page-link" (click)="approvedPageIndex = 0" title="First Page">
                  <i class="bi bi-chevron-double-left"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="approvedPageIndex === 0">
                <button class="page-link" (click)="approvedPageIndex = approvedPageIndex - 1" title="Previous Page">
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>
              <li class="page-item" *ngFor="let page of getApprovedPages()" [class.active]="approvedPageIndex === page">
                <button class="page-link" (click)="approvedPageIndex = page">{{ page + 1 }}</button>
              </li>
              <li class="page-item" [class.disabled]="approvedPageIndex === getApprovedTotalPages() - 1">
                <button class="page-link" (click)="approvedPageIndex = approvedPageIndex + 1" title="Next Page">
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="approvedPageIndex === getApprovedTotalPages() - 1">
                <button class="page-link" (click)="approvedPageIndex = getApprovedTotalPages() - 1" title="Last Page">
                  <i class="bi bi-chevron-double-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>