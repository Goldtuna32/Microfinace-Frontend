<div class="container mx-auto p-4">
  <div class="card shadow-lg">
    <div class="card-body">
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-danger mb-4" role="alert">
        {{ errorMessage }}
      </div>

      <!-- Tabs -->
      <ul class="nav nav-tabs bg-gray-100 mb-4" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">
            Pending Loans (Status: 3)
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab" aria-controls="approved" aria-selected="false">
            Approved Loans (Status: 4)
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- Pending Loans Tab -->
        <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead class="bg-dark text-blue-400">
                <tr>
                  <th scope="col" class="p-3">ID</th>
                  <th scope="col" class="p-3">Loan Amount</th>
                  <th scope="col" class="p-3">Interest Rate (%)</th>
                  <th scope="col" class="p-3">Grace Period (days)</th>
                  <th scope="col" class="p-3">Repayment Duration (months)</th>
                  <th scope="col" class="p-3">Document Fee</th>
                  <th scope="col" class="p-3">Service Charges</th>
                  <th scope="col" class="p-3">Current Account ID</th>
                  <th scope="col" class="p-3">Late Fee Rate (%)</th>
                  <th scope="col" class="p-3">90-Day Late Fee Rate (%)</th>
                  <th scope="col" class="p-3">180-Day Late Fee Rate (%)</th>
                  <th scope="col" class="p-3">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of pendingLoansDataSource.data | slice: (pendingPageIndex * pendingPageSize) : ((pendingPageIndex + 1) * pendingPageSize)">
                  <td class="p-3">{{ loan.id }}</td>
                  <td class="p-3">{{ loan.loanAmount | currency }}</td>
                  <td class="p-3">{{ loan.interestRate }}</td>
                  <td class="p-3">{{ loan.gracePeriod }}</td>
                  <td class="p-3">{{ loan.repaymentDuration }}</td>
                  <td class="p-3">{{ loan.documentFee | currency }}</td>
                  <td class="p-3">{{ loan.serviceCharges | currency }}</td>
                  <td class="p-3">{{ loan.currentAccountId }}</td>
                  <td class="p-3">{{ loan.late_fee_rate }}</td>
                  <td class="p-3">{{ loan.ninety_day_late_fee_rate }}</td>
                  <td class="p-3">{{ loan.one_hundred_and_eighty_day_late_fee_rate }}</td>
                  <td class="p-3">
                    <div class="dropdown" #dropdown>
                      <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" (click)="toggleDropdown(dropdown)" aria-expanded="false">
                        <i class="bi bi-gear me-1"></i> Actions
                      </button>
                      <ul class="dropdown-menu shadow-sm" [ngClass]="{'show': isDropdownOpen}">
                        <li><button class="dropdown-item" (click)="editLoan(loan)"><i class="bi bi-pencil text-primary me-2"></i> Edit</button></li>
                        <li><button class="dropdown-item" (click)="deleteLoan(loan)"><i class="bi bi-trash text-danger me-2"></i> Delete</button></li>
                        <li *ngIf="loan.status === 3"><button class="dropdown-item" (click)="approveLoan(loan)"><i class="bi bi-check-circle text-success me-2"></i> Approve</button></li>
                        <li><button class="dropdown-item" (click)="viewDetails(loan)"><i class="bi bi-eye text-teal-600 me-2"></i> View Details</button></li>
                      </ul>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="!pendingLoansDataSource.data.length">
                  <td colspan="12" class="text-center p-4">No pending loans found.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <nav class="mt-4" *ngIf="pendingLoansDataSource.data.length">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.disabled]="pendingPageIndex === 0">
                <button class="page-link" (click)="pendingPageIndex = 0"><i class="bi bi-chevron-double-left"></i></button>
              </li>
              <li class="page-item" [class.disabled]="pendingPageIndex === 0">
                <button class="page-link" (click)="pendingPageIndex = pendingPageIndex - 1"><i class="bi bi-chevron-left"></i></button>
              </li>
              <li class="page-item" *ngFor="let page of getPendingPages()" [class.active]="pendingPageIndex === page">
                <button class="page-link" (click)="pendingPageIndex = page">{{ page + 1 }}</button>
              </li>
              <li class="page-item" [class.disabled]="pendingPageIndex === getPendingTotalPages() - 1">
                <button class="page-link" (click)="pendingPageIndex = pendingPageIndex + 1"><i class="bi bi-chevron-right"></i></button>
              </li>
              <li class="page-item" [class.disabled]="pendingPageIndex === getPendingTotalPages() - 1">
                <button class="page-link" (click)="pendingPageIndex = getPendingTotalPages() - 1"><i class="bi bi-chevron-double-right"></i></button>
              </li>
            </ul>
          </nav>
        </div>

        <!-- Approved Loans Tab -->
        <div class="tab-pane fade" id="approved" role="tabpanel " aria-labelledby="approved-tab">
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead class="bg-dark text-blue-400">
                <tr>
                  <th scope="col" class="p-3">ID</th>
                  <th scope="col" class="p-3">Loan Amount</th>
                  <th scope="col" class="p-3">Interest Rate (%)</th>
                  <th scope="col" class="p-3">Grace Period (days)</th>
                  <th scope="col" class="p-3">Repayment Duration (months)</th>
                  <th scope="col" class="p-3">Document Fee</th>
                  <th scope="col" class="p-3">Service Charges</th>
                  <th scope="col" class="p-3">Current Account ID</th>
                  <th scope="col" class="p-3">Late Fee Rate (%)</th>
                  <th scope="col" class="p-3">90-Day Late Fee Rate (%)</th>
                  <th scope="col" class="p-3">180-Day Late Fee Rate (%)</th>
                  <th scope="col" class="p-3">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of approvedLoansDataSource.data | slice: (approvedPageIndex * approvedPageSize) : ((approvedPageIndex + 1) * approvedPageSize)">
                  <td class="p-3">{{ loan.id }}</td>
                  <td class="p-3">{{ loan.loanAmount | currency }}</td>
                  <td class="p-3">{{ loan.interestRate }}</td>
                  <td class="p-3">{{ loan.gracePeriod }}</td>
                  <td class="p-3">{{ loan.repaymentDuration }}</td>
                  <td class="p-3">{{ loan.documentFee | currency }}</td>
                  <td class="p-3">{{ loan.serviceCharges | currency }}</td>
                  <td class="p-3">{{ loan.currentAccountId }}</td>
                  <td class="p-3">{{ loan.late_fee_rate }}</td>
                  <td class="p-3">{{ loan.ninety_day_late_fee_rate }}</td>
                  <td class="p-3">{{ loan.one_hundred_and_eighty_day_late_fee_rate }}</td>
                  <td class="p-3">
                    <div class="dropdown">
                      <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-gear me-1"></i> Actions
                      </button>
                      <ul class="dropdown-menu shadow-sm">
                        <li><button class="dropdown-item" (click)="viewDetails(loan)"><i class="bi bi-eye text-teal-600 me-2"></i> View Details</button></li>
                        <li><button class="dropdown-item" (click)="showRepaymentSchedule(loan)"><i class="bi bi-calendar text-purple-600 me-2"></i> Show Repayment Schedule</button></li>
                      </ul>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="!approvedLoansDataSource.data.length">
                  <td colspan="12" class="text-center p-4">No approved loans found.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <nav class="mt-4" *ngIf="approvedLoansDataSource.data.length">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.disabled]="approvedPageIndex === 0">
                <button class="page-link" (click)="approvedPageIndex = 0"><i class="bi bi-chevron-double-left"></i></button>
              </li>
              <li class="page-item" [class.disabled]="approvedPageIndex === 0">
                <button class="page-link" (click)="approvedPageIndex = approvedPageIndex - 1"><i class="bi bi-chevron-left"></i></button>
              </li>
              <li class="page-item" *ngFor="let page of getApprovedPages()" [class.active]="approvedPageIndex === page">
                <button class="page-link" (click)="approvedPageIndex = page">{{ page + 1 }}</button>
              </li>
              <li class="page-item" [class.disabled]="approvedPageIndex === getApprovedTotalPages() - 1">
                <button class="page-link" (click)="approvedPageIndex = approvedPageIndex + 1"><i class="bi bi-chevron-right"></i></button>
              </li>
              <li class="page-item" [class.disabled]="approvedPageIndex === getApprovedTotalPages() - 1">
                <button class="page-link" (click)="approvedPageIndex = getApprovedTotalPages() - 1"><i class="bi bi-chevron-double-right"></i></button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>